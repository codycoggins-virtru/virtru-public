x-google-marketplace:
#* schema level properties
  schemaVersion: v2

  applicationApiVersion: v1beta1
  # The published version is required and MUST match the tag
  # of the deployer image
  publishedVersion: '$TAG' # latest published image tag 
  publishedVersionMetadata:
    releaseNote: >-
      A first release.
  images:
    '':  # Primary image has no name.
      properties:
        image.repository:
          type: REPO_WITH_REGISTRY
        image.tag:
          type: TAG
    ubbagent:
      properties:
        ubbagentImage:
          type: FULL
          default: "gcr.io/cloud-marketplace-tools/metering/ubbagent:latest"

  clusterConstraints:
    k8sVersion: ">=1.16.0"
    assistedClusterCreation:
      type: STRICT
      gke:
       # todo tune these values to be more appropriate
        nodePool:
        - numNodes: 2 
          machineType: e2-standard-2
    resources:
    - replicas: 2
      requests:
        cpu: 300m
        memory: 250Mi
      affinity:
        simpleNodeAffinity:
          type: REQUIRE_MINIMUM_NODE_COUNT
          minimumNodeCount: 1
    istio:
      type: UNSUPPORTED

#* application properties
# Refer to https://github.com/GoogleCloudPlatform/marketplace-k8s-app-tools/blob/master/docs/schema.md
properties:
  name:
    type: string
    x-google-marketplace:
      type: NAME
  namespace:
    type: string
    x-google-marketplace:
      type: NAMESPACE
  gatewayHostname:
    type: string
    title: Gateway Hostname
    description: Hostname of mail relay
    x-google-marketplace:
      type: STRING
  gatewayApiTokenName:
    type: string
    title: Gateway API Token Name
    description: Virtru API token name string
    x-google-marketplace:
      type: STRING
  gatewayApiSecret:
    type: string
    title: Gateway API Secret
    description: Virtru API token secret string
    x-google-marketplace:
      type: STRING
  primaryMailingDomain:
    type: string
    title: Primary Mailing Domain
    description: The primary email domain for your organization
    x-google-marketplace:
      type: STRING
  amplitudeToken:
    type: string
    title: Amplitude API Key
    default: AMPLITUDE_TOKEN
    description: Amplitude API Key. Highly recommended, needed to capture metrics in Amplitude
    x-google-marketplace:
      type: STRING
  pricingPlan:
    type: string
    title: Virtru Pricing Plan
    default: gateway___gmail_encryption__per_user_
    description: Which pricing plan did you select?
    enum:
      - "gateway___gmail_encryption__per_user_"
      - "gateway___gdrive_encryption__per_user_"
      - "gateway___gmail___gdrive_encryption__per_user_"
      - "gateway_network_level_encryption"
      - "gateway__gmail_encryption_with_customer_hosted_keys___per_user_"
      - "gateway__gdrive_encryption_with_customer_hosted_keys___per_user_"
      - "gateway__gmail___gdrive_encryption_with_customer_hosted_keys__per_user_"
      - "gateway_network_level_encryption_with_customer_hosted_keys__per_user_"
    x-google-marketplace:
      type: STRING
  user:
    type: string
    title: Number of Licensed Users
    description: How many users do you wish to license?
    x-google-marketplace:
      type: STRING
  reportingSecret:
    type: string
    x-google-marketplace:
      type: REPORTING_SECRET
required:
- name
- namespace
- gatewayHostname
- gatewayApiTokenName
- gatewayApiSecret
- primaryMailingDomain
- amplitudeToken
- pricingPlan
- user